"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OhosProjectModelBean=void 0;const wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),project_ohos_config_manager_js_1=require("../../../common/global/project-ohos-config-manager.js"),ohos_plugin_id_js_1=require("../../../plugin/common/ohos-plugin-id.js"),map_util_js_1=require("../../../utils/map-util.js"),project_build_profile_loader_js_1=require("../../../utils/loader/file/project-build-profile-loader.js"),path_1=__importDefault(require("path")),core_module_model_impl_1=require("../../../model/module/core-module-model-impl");class OhosProjectModelBean{constructor(e){this.modelId="ohos-project",this._project=e;const o=e.getPluginById(ohos_plugin_id_js_1.OhosPluginId.OHOS_APP_PLUGIN);this._projectTaskService=o.getTaskService()}computeCommonInfo(e){var o,t;const r=(0,wdk_1.cloneDeep)(null===(o=project_ohos_config_manager_js_1.projectOhosConfigManager.getOverrides())||void 0===o?void 0:o.appOpt),i=this._projectTaskService.getTargetProduct(),l=this._projectTaskService.getPathInfo();e.set("SELECT_PRODUCT_NAME",i.name),e.set("MODULE_BUILD_DIR",l.getProjectBuildPath());let s=null!==(t=null==r?void 0:r.bundleName)&&void 0!==t?t:i.bundleName;void 0===s&&(s=this._projectTaskService.getProjectModel().getDefaultBundleName()),e.set("BUNDLE_NAME",s)}computePathInfo(e){const o={OUTPUT_PATH:this._projectTaskService.getPathInfo().getProjectOutputPath()};e.set("BUILD_PATH",o)}computeModulesInfo(e){const o=(0,wdk_1.cloneDeep)(project_build_profile_loader_js_1.projectBuildProfileLoader.getBuildProfile().modules);o.forEach((e=>{var o,t,r;e.srcPath=path_1.default.resolve(this._project.getNodeDir(),e.srcPath),e.belongProjectPath=null===(r=null===(t=null===(o=this._projectTaskService.getProjectModel())||void 0===o?void 0:o.getSubModuleModels())||void 0===t?void 0:t.get(e.name))||void 0===r?void 0:r.getBelongProjectPath()})),e.set("MODULES",o)}computeProfileOpt(e){e.set("PROFILE_OPT",this._projectTaskService.getProjectModel().getProfileOpt())}computeConfigProperties(e){e.set("CONFIG_PROPERTIES",hvigor_1.hvigorCore.getParameter().getProperties())}computeOverallProjectPaths(e){e.set("OVERALL_PROJECT_PATHS",core_module_model_impl_1.validProjectPathSet)}buildModel(){const e=new Map;return this.computeCommonInfo(e),this.computePathInfo(e),this.computeModulesInfo(e),this.computeProfileOpt(e),this.computeConfigProperties(e),this.computeOverallProjectPaths(e),(0,map_util_js_1.strMapToObj)(e)}}exports.OhosProjectModelBean=OhosProjectModelBean;