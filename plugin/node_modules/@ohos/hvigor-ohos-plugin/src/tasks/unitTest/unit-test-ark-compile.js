"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UnitTestArkCompile=void 0;const hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),inject_util_js_1=require("../../utils/inject-util.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),ark_compile_js_1=require("../ark-compile.js"),task_names_js_1=require("../common/task-names.js"),build_unit_test_hook_js_1=require("./build-unit-test-hook.js"),unit_test_process_profile_js_1=require("./unit-test-process-profile.js"),common_const_js_1=require("../../const/common-const.js");class UnitTestArkCompile extends ark_compile_js_1.ArkCompile{constructor(){super(...arguments),this.logger=ohos_logger_js_1.OhosLogger.getLogger(UnitTestArkCompile.name)}declareInputFiles(){return super.declareInputFiles()}async doTaskAction(){await super.doTaskAction()}async initDefaultArkCompileConfig(){var e;this.flushBuildConfig();const t={...await super.initDefaultArkCompileConfig(),aceModuleBuild:path_1.default.resolve(this.pathInfo.getInterMediatesAssetsPath(),this.codeType)},s=inject_util_js_1.InjectUtil.getEntryModulesName();return s.length&&(t.mainModulePath=null===(e=hvigor_1.hvigor.getNodeByName(s[0]))||void 0===e?void 0:e.getNodePath()),t.obfuscationOptions&&delete t.obfuscationOptions,t.testFrameworkPar&&(t.testFrameworkPar.testMode=common_const_js_1.CommonConst.UNIT_TEST),t}initTaskDepends(){this.declareDependsList(build_unit_test_hook_js_1.BuildUnitTestHook.name,unit_test_process_profile_js_1.UnitTestProcessProfile.name)}flushBuildConfig(){if(this.moduleModel.isHspModule()&&hvigor_1.hvigor.isCommandEntryTask(task_names_js_1.TaskNames.Task.TEST.name)){const e=this.pathInfo.getTestBuildConfigPath();fs_extra_1.default.ensureDirSync(path_1.default.dirname(e)),fs_extra_1.default.writeJSONSync(e,{aceModuleBuild:path_1.default.resolve(this.pathInfo.getInterMediatesAssetsPath(),this.codeType)})}}}exports.UnitTestArkCompile=UnitTestArkCompile;