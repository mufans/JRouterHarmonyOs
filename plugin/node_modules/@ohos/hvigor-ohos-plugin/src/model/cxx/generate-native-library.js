"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenerateNativeLibrary=void 0;const path_1=__importDefault(require("path")),native_library_model_js_1=require("./native-library-model.js");class GenerateNativeLibrary{static parseLibrary(t,e,i,s){var r,a;const o=new native_library_model_js_1.NativeLibraryModel(e.name,e.id,e.type);return o.setAbi(t),o.setBuildType(i),o.setFolders(this.findFolders(e)),o.setFiles(this.findFiles(e)),o.setOutputs(this.findOutputs(e)),o.setNameOnDisk(e.nameOnDisk),o.setRuntimeFiles(this.findRuntimeFiles(e,s)),o.setBuild(null===(r=e.paths)||void 0===r?void 0:r.build),o.setSource(null===(a=e.paths)||void 0===a?void 0:a.source),o}static findFolders(t){var e;const i=[];return null===(e=t.compileGroups)||void 0===e||e.forEach((t=>{var e;null===(e=t.includes)||void 0===e||e.forEach((t=>{t.path&&i.push(t.path)}))})),i}static findFiles(t){var e;const i=[];return null===(e=t.sources)||void 0===e||e.forEach((e=>{var s;const r=null!==(s=t.sourceGroups)&&void 0!==s?s:[],a=void 0===e.sourceGroupIndex?void 0:r[e.sourceGroupIndex];a&&"Source Files"!==a.name&&e.path&&i.push(e.path)})),i}static findOutputs(t){var e;const i=[];return null===(e=t.artifacts)||void 0===e||e.forEach((t=>{t.path&&i.push(t.path)})),i}static findRuntimeFiles(t,e){var i,s,r,a;const o=[];let l=null===(s=null===(i=t.link)||void 0===i?void 0:i.sysroot)||void 0===s?void 0:s.path;return l&&(l=path_1.default.resolve(l)),null===(a=null===(r=t.link)||void 0===r?void 0:r.commandFragments)||void 0===a||a.forEach((i=>{var s,r;if("libraries"!==i.role)return;let a=i.fragment;if(a&&!a.startsWith("-")&&!a.endsWith(".a"))if(!path_1.default.isAbsolute(a)||l&&a.startsWith(l)){for(const i of[null===(s=t.paths)||void 0===s?void 0:s.build,null===(r=null==e?void 0:e.paths)||void 0===r?void 0:r.build])if(i){const t=path_1.default.join(i,a);if(l&&t.startsWith(l))continue;o.push(t)}}else o.push(a)})),o}}exports.GenerateNativeLibrary=GenerateNativeLibrary;