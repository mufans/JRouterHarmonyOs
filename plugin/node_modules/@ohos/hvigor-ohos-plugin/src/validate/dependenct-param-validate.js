"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validataParameterKeys=exports.matchValueWithParameterizationKey=void 0;const semver_1=require("semver"),ohos_logger_js_1=require("../utils/log/ohos-logger.js"),dependency_tag_validate_js_1=require("./dependency-tag-validate.js"),log=ohos_logger_js_1.OhosLogger.getLogger("ParameterFileLog"),PARAMETER_KEY_REG=/(?=^(@(?![0-9\-_])[a-z0-9\-_]+(?<![-_])\/)?(?![0-9\-_.])[a-z0-9\-_.]+(?<![-_.])$).{1,128}$/i;function matchValueWithParameterizationKey(e,t,a,r){let i="",o="";for(let a=0;a<e.length;a++){let r=0;for(let l=a;l<e.length;l++){const n=getValueFromJson(e.slice(a,l+1).join("."),o,t);if(n){if("object"==typeof n){o=n,a+=r>0?r:0;break}l===e.length-1&&r>0&&(a+=r),a===e.length-1&&(i=n),r++}else r++}if(!o)break}return!i&&a.parameterFilePath&&log._buildError(`the value of ${e.join(".")} in parameterFile.`)._file(a.parameterFilePath)._printErrorAndExit(),getParameterValue(i,e.join("."),a,r)}function getValueFromJson(e,t,a){return t=getObjectValueByKey(e,t||a)}function getObjectValueByKey(e,t){return"string"==typeof t?t:t[e]}function validataParameterKeys(e){Object.keys(e).forEach((t=>{PARAMETER_KEY_REG.test(t)||log._buildError(`The key: "${t}" in parameterFile is invalid, only support at(@), slashe(/), letters, digits, dots(.), hyphens(-), and underscores(_). For details, see the package name verification rules.`)._printErrorAndExit(),"object"==typeof e[t]&&null!==e[t]&&validataParameterKeys(e[t])}))}function getParameterValue(e,t,a,r){return"latest"===e||"*"===e||(0,dependency_tag_validate_js_1.isValidateTag)({key:t,value:e,parameterFilePath:a.parameterFilePath,ohPackageFilePath:a.ohPackageFilePath,dependencyName:r})||(0,semver_1.validRange)(e,{loose:!0,includePrerelease:!0})||log._buildError(`Invalid version: ${e} in parameterFile, the version must comply with the semver specifications.`)._printErrorAndExit(),e}exports.matchValueWithParameterizationKey=matchValueWithParameterizationKey,exports.validataParameterKeys=validataParameterKeys;