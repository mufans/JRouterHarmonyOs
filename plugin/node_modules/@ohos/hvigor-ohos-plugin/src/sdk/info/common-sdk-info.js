"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommonSdkInfo=void 0;const path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),sdkmanager_common_1=require("@ohos/sdkmanager-common"),fs_extra_1=__importDefault(require("fs-extra")),inject_const_js_1=require("../../const/inject-const.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),sdk_version_enum_js_1=require("../../version/sdk-version-enum.js"),default_sdk_js_1=require("../default-sdk.js"),sdk_ets_component_js_1=require("../impl/sdk-ets-component.js"),sdk_js_component_js_1=require("../impl/sdk-js-component.js"),sdk_native_component_js_1=require("../impl/sdk-native-component.js"),sdk_previewer_component_js_1=require("../impl/sdk-previewer-component.js"),sdk_toolchains_component_js_1=require("../impl/sdk-toolchains-component.js");class CommonSdkInfo extends default_sdk_js_1.DefaultSdk{constructor(e,t){super(),this._log=ohos_logger_js_1.OhosLogger.getLogger(CommonSdkInfo.name),this.sdkVersion=e,this.sdkDir=t}getToolchainsComponentVersion(){var e;return null===(e=this.toolchainsComponent)||void 0===e?void 0:e.getComponentVersion().getVersion()}getModuleSchema(){return this.toolchainsComponent?this.toolchainsComponent.getModuleSchema():""}getAppSchema(){return this.toolchainsComponent?this.toolchainsComponent.getAppSchema():""}getAppConfigurationSchema(){return this.toolchainsComponent?this.toolchainsComponent.getAppConfigurationSchema():""}getInsightIntentSchema(){return this.toolchainsComponent?this.toolchainsComponent.getInsightIntentSchema():""}getUtdSchema(){return this.toolchainsComponent?this.toolchainsComponent.getUtdSchema():""}getFormSchema(){return this.toolchainsComponent?this.toolchainsComponent.getFormSchema():""}getPageSchema(){return this.toolchainsComponent?this.toolchainsComponent.getPageSchema():""}getRouterMapSchema(){return this.toolchainsComponent?this.toolchainsComponent.getRouterMapSchema():""}getAppStartupSchema(){return this.toolchainsComponent?this.toolchainsComponent.getAppStartupSchema():""}getSysCapSchema(){return this.toolchainsComponent?this.toolchainsComponent.getSysCapSchema():""}getSdkJsDir(){return this.jsComponent?this.jsComponent.getBaseDir():""}getSdkEtsDir(){return this.etsComponent?this.etsComponent.getBaseDir():""}getSdkVersion(){return this.sdkVersion.version}getSdkApi(){return this.sdkVersion.api}getHapTobin(){return this.jsComponent.getHapToBinFilePath()}getReleaseType(){return this.toolchainsComponent?this.toolchainsComponent.getReleaseType():"Release"}getSdkNativeDir(){return this.nativeComponent.getBaseDir()}getCmakeTool(){return this.nativeComponent.getCmakeTool()}getNativeNinjaTool(){return this.nativeComponent.getNinjaTool()}getNativeToolchain(){return this.nativeComponent.getNativeToolchain()}getNdkVersion(){return this.nativeComponent.getComponentVersion()}getSdkToolchainsDir(){return this.toolchainsComponent?this.toolchainsComponent.getBaseDir():""}getSdkLlvmStrip(){return this.nativeComponent.getLlvmStrip()}getSdkLlvmReadElf(){return this.nativeComponent.getLlvmReadElf()}getRestool(){return this.toolchainsComponent?this.toolchainsComponent.getRestoolPath():""}getSysCapTool(){return this.toolchainsComponent?this.toolchainsComponent.getSysCapToolPath():""}getSysCapFileInEts(){return this.etsComponent?this.etsComponent.getSysCapFilePath():""}getSysCapFileInJs(){return this.jsComponent?this.jsComponent.getSysCapFilePath():""}getVerifySignConfigTool(){return this.toolchainsComponent?this.toolchainsComponent.getVerifySignConfigToolPath():""}getJsArkVersion(e,t){if(!this.jsComponent)return"";if(this.findNoAbcTool(this.jsComponent.getJsLoaderPath()))return this._log.warn("Ark tools not found. Cannot get ark version."),"";const o=this.jsComponent.getCompatibleArkVersion(e,t);return o&&""!==o?o:this.jsComponent.getArkVersion()}getRichSchema(){return this.toolchainsComponent?this.toolchainsComponent.getRichSchema():""}getLiteSchema(){return this.toolchainsComponent?this.toolchainsComponent.getLiteSchema():""}getEtsArkVersion(e,t){if(!this.etsComponent)return"";if(this.findNoAbcTool(this.etsComponent.getEtsLoaderPath()))return this._log.warn("Ark tools not found. Cannot get ark version."),"";const o=this.etsComponent.getCompatibleArkVersion(e,t);return o&&""!==o?o:this.etsComponent.getArkVersion()}getEtsComponentVersion(){return this.etsComponent?this.etsComponent.getComponentVersion().getVersion():""}getEtsComponentReleaseType(){return this.etsComponent?this.etsComponent.getReleaseType():"Release"}getArkVersion(e,t){const o=this.getEtsArkVersion(e,t);return o&&""!==o?o:this.getJsArkVersion(e,t)}getPackageTool(){return this.toolchainsComponent?this.toolchainsComponent.getPackageToolPath():""}getBasePath(){var e,t;return null!==(t=null===(e=this.toolchainsComponent)||void 0===e?void 0:e.getBaseDir())&&void 0!==t?t:""}getPreviewerCommonBinDir(){var e,t;return null!==(t=null===(e=this.previewerComponent)||void 0===e?void 0:e.getCommonBin())&&void 0!==t?t:""}getPreviewerPermissionNames(){var e,t;return null!==(t=null===(e=this.previewerComponent)||void 0===e?void 0:e.getSdkPermissionNames())&&void 0!==t?t:[]}getPreviewerUserGrant(){var e,t;return null!==(t=null===(e=this.previewerComponent)||void 0===e?void 0:e.getSdkDefineUserGrant())&&void 0!==t?t:[]}allowSdkPermission(){var e,t;return null!==(t=null===(e=this.previewerComponent)||void 0===e?void 0:e.allowSdkPermission)&&void 0!==t&&t}getSignDir(){return this.toolchainsComponent?this.toolchainsComponent.getSignDir():""}getJsLoader(){return this.jsComponent?this.jsComponent.getJsLoaderPath():""}getEtsLoader(){return this.etsComponent?this.etsComponent.getEtsLoaderPath():""}requireUISyntax(){return void 0!==this.jsComponent&&void 0!==this.etsComponent?this.jsComponent.requireUISyntax()||this.etsComponent.requireUISyntax():void 0!==this.etsComponent?this.etsComponent.requireUISyntax():void 0!==this.jsComponent&&this.jsComponent.requireUISyntax()}isPreviewCompileResourceIncrement(e){var t;const o=hvigor_1.hvigorCore.getExtraConfig().get(inject_const_js_1.InjectConst.PREVIEWER_COMPILE_RES_INC),n=this.sdkVersion.version>=9;return"true"===o&&n&&!!(null===(t=this.toolchainsComponent)||void 0===t?void 0:t.supportCompileResourceIncrement(e))}supportOhpmProject(e){var t;return!!(null===(t=this.toolchainsComponent)||void 0===t?void 0:t.supportOhpmProject(e))}supportHapSignToolApiCall(e){var t,o;const n=null===(t=this.toolchainsComponent)||void 0===t?void 0:t.getComponentApiVersion(),s=null===(o=this.toolchainsComponent)||void 0===o?void 0:o.getComponentVersion();return!(!n||!s)&&(n>12||(12===n?s.isHigherThan(sdk_version_enum_js_1.SdkVersionEnum.SUPPORT_HAP_SIGN_TOOL_API_CALL_API12):11===n&&(e?s.isHigherThan(sdk_version_enum_js_1.SdkVersionEnum.HOS_SUPPORT_HAP_SIGN_TOOL_API_CALL_API11):s.isHigherThan(sdk_version_enum_js_1.SdkVersionEnum.OHOS_SUPPORT_HAP_SIGN_TOOL_API_CALL_API11))))}initComponent(e){switch(e.getPath()){case sdkmanager_common_1.ComponentPath.JS:this.jsComponent=new sdk_js_component_js_1.SdkJsComponent(e);break;case sdkmanager_common_1.ComponentPath.ETS:this.etsComponent=new sdk_ets_component_js_1.SdkEtsComponent(e);break;case sdkmanager_common_1.ComponentPath.TOOLCHAINS:this.toolchainsComponent=new sdk_toolchains_component_js_1.SdkToolchainsComponent(e);break;case sdkmanager_common_1.ComponentPath.NATIVE:this.nativeComponent=new sdk_native_component_js_1.SdkNativeComponent(e);break;case sdkmanager_common_1.ComponentPath.PREVIEWER:this.previewerComponent=new sdk_previewer_component_js_1.SdkPreviewerComponent(e)}}findNoAbcTool(e){const t=path_1.default.resolve(e,"bin","ark","ts2abc.js");return!t||!fs_extra_1.default.existsSync(t)}}exports.CommonSdkInfo=CommonSdkInfo;