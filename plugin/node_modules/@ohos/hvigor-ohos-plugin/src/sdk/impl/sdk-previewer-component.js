"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SdkPreviewerComponent=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),hvigor_1=require("@ohos/hvigor"),json_util_js_1=require("../../utils/json-util.js"),log_adaptor_js_1=require("../../utils/log/log-adaptor.js"),sdk_component_js_1=require("../superior/sdk-component.js");class SdkPreviewerComponent extends sdk_component_js_1.SdkComponent{constructor(e){super(e),this.logger=hvigor_1.HvigorLogger.getLogger(SdkPreviewerComponent.name),this.sdkDefinePermissions=new Map,this.allowSdkPermission=!1,this.setPermissionData()}getCommonBin(){return path_1.default.resolve(this.getBaseDir(),SdkPreviewerComponent.COMMON,SdkPreviewerComponent.BIN)}setPermissionData(){var e,o;this.logger.debug("Start recording SDK configuration permission data.");const s=path_1.default.resolve(this.getBaseDir(),SdkPreviewerComponent.COMMON,SdkPreviewerComponent.RESOURCES_MODULE);if(!fs_1.default.existsSync(s))return void this.logger.debug(`The file does not exist. At ${s}`);const r=null===(o=null===(e=(0,json_util_js_1.getJson5Obj)(s))||void 0===e?void 0:e.module)||void 0===o?void 0:o.definePermissions;r?(r.forEach((e=>{const o=e.grantMode,s=this.sdkDefinePermissions.get(o)||[];this.sdkDefinePermissions.set(o,[...s,e.name])})),this.allowSdkPermission=r.length>0):this.logger.warn(new log_adaptor_js_1.OhosLogAdaptor("HE10306",hvigor_1.globalData.buildId).formatMessage(s).getLogMessage().message)}getSdkPermissionNames(){return Array.from(this.sdkDefinePermissions.values()).reduce(((e,o)=>[...e,...o]),[])}getSdkDefineUserGrant(){return this.sdkDefinePermissions.get("user_grant")||[]}}exports.SdkPreviewerComponent=SdkPreviewerComponent,SdkPreviewerComponent.COMMON="common",SdkPreviewerComponent.BIN="bin",SdkPreviewerComponent.RESOURCES_MODULE="resources/module.json";