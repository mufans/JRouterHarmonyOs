"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.traceManager=exports.TraceManager=void 0;const path_1=__importDefault(require("path")),wdk_1=require("@baize/wdk"),fs_extra_1=__importDefault(require("fs-extra")),hash_util_js_1=require("../../../common/util/hash-util.js"),path_util_js_1=require("../../../common/util/path-util.js"),replacer_js_1=require("../../../common/util/replacer.js");class TraceManager{constructor(){this.callBackList={},this.data={},this.callBackList={}}trace(t,e,a){this.data[t]=e,"function"==typeof a&&(this.callBackList[t]=a)}flush(){const t=(0,wdk_1.cloneDeep)(this.data);for(const t in this.callBackList)this.callBackList[t]();const e=path_1.default.resolve(path_util_js_1.PathUtil.getHvigorCacheDir(),"./outputs/logs/details"),a=path_1.default.resolve(e,"details.json");fs_extra_1.default.ensureDirSync(e);try{fs_extra_1.default.writeFileSync(a,JSON.stringify(t,replacer_js_1.replacer,2))}catch(t){}}static transformKey(t){return t.replace(".","_")}static anonymize(t){return(0,hash_util_js_1.hash)(t)}static trace(t,e,a){exports.traceManager.trace(t,e,a)}}exports.TraceManager=TraceManager,exports.traceManager=new TraceManager;