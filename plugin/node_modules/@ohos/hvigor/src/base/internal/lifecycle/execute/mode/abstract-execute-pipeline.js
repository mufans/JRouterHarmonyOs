"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractExecutePipeline=void 0;const common_const_js_1=require("../../../../common/options/common-const.js"),class_identify_util_js_1=require("../../../../util/class-identify-util.js"),task_executor_js_1=require("../../../core/task-executor.js"),task_runner_js_1=require("../../../task/core/task-runner.js"),task_path_util_js_1=require("../../../task/util/task-path-util.js");class AbstractExecutePipeline{constructor(s,t){this.shouldCheckTask=!1,this.project=s,this.taskOptions=t;const e=this.taskOptions.toRunTasks;this.toRunTask=e.length?e:["default"]}async startPipeline(){this.taskOptions.isNeedSync||this.recordTraceData(),await this.executeTask()}findAllNeedExecuteTasksForNodes(s){const t=[];return this.toRunTask.forEach((e=>{const i=s.filter((s=>s.hasTask(e))).map((s=>(0,task_path_util_js_1.union)((0,class_identify_util_js_1.instanceOf)(s,common_const_js_1.HvigorBuildConst.PROJECT_MODE)?"":s.getName(),e)));t.push(...i)})),t}recordTraceData(){}async executeTask(){const s=this.taskOptions.isNeedSync?this.findPipeAllNeedExecuteSyncTasks():[];s.push(...this.findPipeAllNeedExecuteTasks()),await task_executor_js_1.taskExecutorInst.initTasks(s),await(0,task_runner_js_1.runTaskFromQueue)()}}exports.AbstractExecutePipeline=AbstractExecutePipeline;