"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HvigorLifecycleHook=void 0;const hook_const_js_1=require("../../../../common/const/hook-const.js"),hvigor_core_js_1=require("../../../external/core/hvigor-core.js"),hvigor_log_js_1=require("../../../log/hvigor-log.js"),_log=hvigor_log_js_1.HvigorLogger.getLogger("HvigorLifecycleHook");class HvigorLifecycleHook{constructor(){this.configEvaluatedFnList=[],this.nodesInitializedFnList=[],this.beforeNodeEvaluateFnList=[],this.afterNodeEvaluateFnList=[],this.nodesEvaluatedFnList=[],this.taskGraphResolvedFnList=[],this.buildFinishedFnList=[],this.strategies={[hook_const_js_1.HookType.configEvaluated]:async t=>{await this.runFn(this.configEvaluatedFnList,t)},[hook_const_js_1.HookType.nodesInitialized]:async t=>{await this.runFn(this.nodesInitializedFnList,t)},[hook_const_js_1.HookType.beforeNodeEvaluate]:async t=>{await this.runFn(this.beforeNodeEvaluateFnList,t)},[hook_const_js_1.HookType.afterNodeEvaluate]:async t=>{await this.runFn(this.afterNodeEvaluateFnList,t)},[hook_const_js_1.HookType.nodesEvaluated]:async t=>{await this.runFn(this.nodesEvaluatedFnList,t)},[hook_const_js_1.HookType.taskGraphResolved]:async t=>{await this.runFn(this.taskGraphResolvedFnList,t)},[hook_const_js_1.HookType.buildFinished]:async t=>{await this.runFn(this.buildFinishedFnList,t)}}}static getInstance(){return HvigorLifecycleHook.instance||(HvigorLifecycleHook.instance=new HvigorLifecycleHook),HvigorLifecycleHook.instance}async runFn(t,o){for(const s of t)s&&await s.bind(this)(o)}async runHook(t,o,s){const e=null==s?void 0:s.createSubEvent(`"${hook_const_js_1.HookType[t]}" hook function`,"").start();try{await this.strategies[t].bind(this)(o),null==e||e.stop().setLog()}catch(t){t instanceof Error&&(null==e||e.stop().setLog(),_log.errorExit(t))}}configEvaluated(t){this.configEvaluatedFnList.push(t)}nodesInitialized(t){this.nodesInitializedFnList.push(t)}beforeNodeEvaluate(t){this.beforeNodeEvaluateFnList.push(t)}afterNodeEvaluate(t){this.afterNodeEvaluateFnList.push(t)}nodesEvaluated(t){this.nodesEvaluatedFnList.push(t)}taskGraphResolved(t){this.taskGraphResolvedFnList.push(t)}buildFinished(t){this.buildFinishedFnList.push(t)}clear(){this.configEvaluatedFnList=[],this.nodesInitializedFnList=[],this.beforeNodeEvaluateFnList=[],this.afterNodeEvaluateFnList=[],this.nodesEvaluatedFnList=[],this.taskGraphResolvedFnList=[],this.buildFinishedFnList=[],hvigor_core_js_1.hvigorCore.clearHvigorInternalHookList()}}exports.HvigorLifecycleHook=HvigorLifecycleHook;