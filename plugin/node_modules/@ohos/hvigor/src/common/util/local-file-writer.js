"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalFileWriter=void 0;const path_1=__importDefault(require("path")),fs_extra_1=__importDefault(require("fs-extra")),replacer_js_1=require("./replacer.js");class LocalFileWriter{constructor(){this._replacer=replacer_js_1.replacer,this._space=2}withSpace(e){this._space=e}withReplacer(e){this._replacer=e}write(e,t){try{const r=JSON.stringify(t,this._replacer,this._space);this.writeStr(e,r)}catch(r){const i=this.chunkStringify(t);this.writeStrArr(e,i)}}chunkStringify(e){const t=Object.keys(e),r=["{\n"],i=new Array(this._space).fill(" ").join("");return t.forEach((t=>{if(Array.isArray(e[t])&&e[t].length){r.push(`${i}${JSON.stringify(t)}: [\n`);let s="";for(let a=0;a<e[t].length;a++){const c=e[t][a],n=`${JSON.stringify(c,this._replacer,this._space).split("\n").map((e=>`${i}${i}${e}`)).join("\n")},\n`;s.length>=1e8?(r.push(s),s=n):s+=n}r.push(`${s.replace(/,\n$/,"\n")}${i}],\n`)}else r.push(`${i}${JSON.stringify(t)}: ${JSON.stringify(e[t],this._replacer,this._space)},\n`)})),r[r.length-1]=r[r.length-1].replace(/,\n$/,"\n"),r.push("}"),r}writeStr(e,t){const r=path_1.default.dirname(e);fs_extra_1.default.existsSync(r)||fs_extra_1.default.mkdirSync(r,{recursive:!0}),fs_extra_1.default.writeFileSync(e,t)}writeStrArr(e,t){const r=path_1.default.dirname(e);fs_extra_1.default.existsSync(r)||fs_extra_1.default.mkdirSync(r,{recursive:!0}),fs_extra_1.default.writeFileSync(e,""),t.forEach((t=>{fs_extra_1.default.appendFileSync(e,t)}))}static getInstance(){return LocalFileWriter.instance||(LocalFileWriter.instance=new LocalFileWriter),LocalFileWriter.instance}}exports.LocalFileWriter=LocalFileWriter;